<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Star Shuttlers</title>
<style>
*{box-sizing:border-box;font-family:Arial,sans-serif;}
body{margin:0;background:#f4f7fb;}
header{background:linear-gradient(135deg,#0a3d62,#1e3799);color:white;padding:20px;text-align:center;}
nav{display:flex;flex-wrap:wrap;background:#1e3799;}
nav button{flex:1;padding:12px;border:none;background:none;color:white;cursor:pointer;font-size:15px;}
nav button:hover{background:#4a69bd;}
.container{padding:20px;}
.card{background:white;padding:20px;border-radius:10px;box-shadow:0 4px 10px rgba(0,0,0,0.08);margin-bottom:20px;}
input,select{width:100%;padding:10px;margin:8px 0;border-radius:6px;border:1px solid #ccc;}
button.primary{background:#1e3799;color:white;padding:10px;border:none;border-radius:6px;cursor:pointer;width:100%;margin-top:5px;}
button.danger{background:#e55039;color:white;padding:10px;border:none;border-radius:6px;cursor:pointer;width:100%;margin-top:5px;}
.dashboard{display:grid;grid-template-columns:repeat(auto-fit,minmax(150px,1fr));gap:15px;}
.count-box{background:#1e3799;color:white;padding:15px;border-radius:8px;text-align:center;}
.tab-content{display:none;}
.active{display:block;}
</style>
</head>
<body>
<header>
<h1>ğŸ¸ Star Shuttlers</h1>
<p>Community Badminton Group</p>
</header>

<nav>
<button onclick="openTab('Home')">Home</button>
<button onclick="openTab('Tuesday')">Tuesday</button>
<button onclick="openTab('Friday')">Friday</button>
<button onclick="openTab('Saturday')">Saturday</button>
<button onclick="openTab('Sunday')">Sunday</button>
</nav>

<div class="container">
<div id="Home" class="tab-content">
<div class="card">
<h2>ğŸ“Š Live Dashboard</h2>
<div class="dashboard">
<div class="count-box">Tuesday<br><span id="TuesdayCount"></span></div>
<div class="count-box">Friday<br><span id="FridayCount"></span></div>
<div class="count-box">Saturday<br><span id="SaturdayCount"></span></div>
<div class="count-box">Sunday<br><span id="SundayCount"></span></div>
</div>
</div>

<!-- Admin Panel -->
<button onclick="adminLogin()">ğŸ” Admin Login</button>
<div id="adminPanel" style="display:none;" class="card">
<h2>Admin Panel</h2>
<label>Tuesday Courts</label><input type="number" id="TuesdayCourts" min="0" value="1">
<label>Friday Courts</label><input type="number" id="FridayCourts" min="0" value="1">
<label>Saturday Courts</label><input type="number" id="SaturdayCourts" min="0" value="1">
<label>Sunday Courts</label><input type="number" id="SundayCourts" min="0" value="1">
<button class="primary" onclick="saveCourt('Tuesday')">Save Tuesday</button>
<button class="primary" onclick="saveCourt('Friday')">Save Friday</button>
<button class="primary" onclick="saveCourt('Saturday')">Save Saturday</button>
<button class="primary" onclick="saveCourt('Sunday')">Save Sunday</button>
</div>

<div class="card">
<h2>ğŸ“ Booking Form</h2>
<input type="text" placeholder="Your Name" id="name">
<select id="day">
<option value="Tuesday">Tuesday</option>
<option value="Friday">Friday</option>
<option value="Saturday">Saturday</option>
<option value="Sunday">Sunday</option>
</select>
<input type="time" id="time">
<button class="primary" onclick="bookPlayer()">Book</button>
<button class="danger" onclick="cancelPlayer()">Cancel</button>
</div>

<div class="card">
<h2>ğŸ‘¥ Player List</h2>
<ul id="playerList"></ul>
</div>
</div>

<div id="Tuesday" class="tab-content container"><div class="card"><h2>Tuesday Games</h2></div></div>
<div id="Friday" class="tab-content container"><div class="card"><h2>Friday Games</h2></div></div>
<div id="Saturday" class="tab-content container"><div class="card"><h2>Saturday Games</h2></div></div>
<div id="Sunday" class="tab-content container"><div class="card"><h2>Sunday Games</h2></div></div>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbzmtioFvwzFOKRJU8rjZGqnVlQTsEIAwpBjTaNyFgtGtdzwnAmkmdvxP3Ni7x0ne-9U0Q/exec";
const bookingLink = "https://mm1212-cmd.github.io/Star-Shuttlers/";
const whatsappNumber = ""; // Leave blank for now
const adminPassword = "staradmin";

let courtSettings = {};
let currentCounts = {};
let waitlist = {};

function openTab(tab){
  let tabs=document.getElementsByClassName("tab-content");
  for(let t of tabs){t.style.display="none";}
  document.getElementById(tab).style.display="block";
}

function adminLogin(){
  const pass = prompt("Enter Admin Password");
  if(pass === adminPassword){document.getElementById("adminPanel").style.display="block";}
  else{alert("Wrong password âŒ");}
}

async function saveCourt(day){
  const courts = parseInt(document.getElementById(day+"Courts").value);
  await fetch(scriptURL,{method:"POST",body:JSON.stringify({type:"updateCourts",day:day,courts:courts})});
  alert("Saved âœ…");
  loadData();
}

function getMax(day){ return (courtSettings[day]||1)*4; }

async function bookPlayer(){
  const name = document.getElementById("name").value;
  const day = document.getElementById("day").value;
  const time = document.getElementById("time").value;
  if(currentCounts[day]>=getMax(day)){
    if(!waitlist[day]) waitlist[day] = [];
    waitlist[day].push({name,time});
    alert("Session Full. Added to Waitlist ğŸŸ¡");
    return;
  }
  await fetch(scriptURL,{method:"POST",body:JSON.stringify({type:"booking",name,day,time,status:"Booked"})});
  loadData();
}

async function cancelPlayer(){
  const name = document.getElementById("name").value;
  const day = document.getElementById("day").value;
  const time = document.getElementById("time").value;
  await fetch(scriptURL,{method:"POST",body:JSON.stringify({type:"booking",name,day,time,status:"Cancelled"})});

  // Auto promote from waitlist
  if(waitlist[day] && waitlist[day].length>0){
    const promoted = waitlist[day].shift();
    await fetch(scriptURL,{method:"POST",body:JSON.stringify({type:"booking",name:promoted.name,day,time:promoted.time,status:"Booked"})});
    if(whatsappNumber){
      const msg=`ğŸ‰ Spot Available!\n${promoted.name} promoted from waitlist for ${day}.\nBook here:\n${bookingLink}`;
      window.open(`https://wa.me/${whatsappNumber}?text=${encodeURIComponent(msg)}`);
    }
  }
  loadData();
}

async function loadData(){
  const res = await fetch(scriptURL);
  const data = await res.json();
  let counts = {Tuesday:0,Friday:0,Saturday:0,Sunday:0};
  let listHTML = "";

  // Update court settings
  for(let i=1;i<data.settings.length;i++){ courtSettings[data.settings[i][0]] = data.settings[i][1]; }

  // Update bookings
  for(let i=1;i<data.bookings.length;i++){
    const row = data.bookings[i], name=row[0], day=row[1], time=row[2], status=row[3];
    if(status==="Booked"){ counts[day]++; listHTML+=`<li>${name} - ${day} (${time})</li>`; }
    if(status==="Cancelled"){ listHTML+=`<li style="text-decoration:line-through;color:red">${name} - ${day} (${time})</li>`; }
  }
  currentCounts = counts;

  // Update dashboard
  for(let day in counts){
    const full = counts[day]>=getMax(day);
    document.getElementById(day+"Count").innerText = counts[day]+" / "+getMax(day)+(full?" ğŸ”´ FULL":"");
  }
  document.getElementById("playerList").innerHTML=listHTML;
}

window.onload = function(){ openTab("Home"); loadData(); }
</script>
</body>
</html>